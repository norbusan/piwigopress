(function(a){a.fn.extend({insertAtCaret:function(b){return this.each(function(e){if(document.selection){this.focus();sel=document.selection.createRange();sel.text=b;this.focus()}else{if(this.selectionStart||this.selectionStart=="0"){var d=this.selectionStart;var c=this.selectionEnd;var f=this.scrollTop;this.value=this.value.substring(0,d)+b+this.value.substring(c,this.value.length);this.focus();this.selectionStart=d+b.length;this.selectionEnd=d+b.length;this.scrollTop=f}else{this.value+=b;this.focus()}}})}});a(document).ready(function(){var b=true;a("a#PWGP_button").unbind().click(function(){if(b){if(a("#dashboard-widgets-wrap").size()==0){var c="#poststuff"}else{var c="#dashboard-widgets-wrap"}if(a("#PWGP_shortcoder").size()==0){var d=a("#PWGP_Gal_finder").html();a(c).before('<div id="PWGP_shortcoder" />');a("#PWGP_shortcoder").html(d);a("#PWGP_Gal_finder").remove()}else{a("#PWGP_shortcoder").show()}a("#PWGP_catscroll").on("focus",function(){current_catid=this.value}).change(function(){if(current_catid!=this.value){a("#PWGP_more").hide();a("#PWGP_hide").hide();a("#PWGP_show").hide();a("#PWGP_show_stats").hide()}});a("#PWGP_finder").focus(function(){current_url=this.value}).change(function(){if(current_url!=this.value){a("#PWGP_more").hide();a("#PWGP_hide").hide();a("#PWGP_show").hide();a("#PWGP_show_stats").hide();a("#PWGP_catscroll").hide();a("#PWGP_loadcat").show();a("#PWGP_catscroll").val(0)}});a("#PWGP_loadcat").unbind().click(function(){var e=a("#PWGP_finder").val();a("#PWGP_Load_Active").show();a.ajax({url:PwgpAjax.ajaxUrl,method:"POST",data:{action:"pwgp-categories",nonce:PwgpAjax.nonce,url:e},dataType:"json",success:function(j){var h=a("#PWGP_catscroll");a('#PWGP_catscroll option[value!="0"]').remove();if(j.stat=="ok"){var g=j.result.categories;for(var l=0;l<g.length;l++){var f=g[l].name;var k=g[l].id;h.append("<option value="+k+">"+f+"</option>")}h.select();h.focus()}},error:function(g,h,f){console.log("cannot load list of piwigo categories: "+h+" "+f+" "+g.responseText)}});a("#PWGP_Load_Active").hide();a("#PWGP_loadcat").hide();a("#PWGP_catscroll").show()});a("#PWGP_load").unbind().click(function(){var j=a("#PWGP_finder").val(),h=5,f=a("#PWGP_dragger"),k=a("#PWGP_dragger li"),e=a("#PWGP_dropping");a(".PWGP_system").show(500);a("#PWGP_Load_Active").show();var g=a("#PWGP_catscroll").val();if(!g){g=0}a.post(PwgpAjax.ajaxUrl,{action:"pwgp-thumbnails",nonce:PwgpAjax.nonce,url:j,category:g},function(l){f.empty().append(l);a("#PWGP_more").show().unbind().click(function(){m()});a("#PWGP_hide").show().unbind().click(function(){var p=Math.max(1,Math.floor(a("li:visible",f).size()/2));for(i=0;i<p;i++){f.find("li:visible").first().hide()}if(a("li:visible",f).size()==0){a("#PWGP_hide").hide()}else{a("#PWGP_show").show().unbind().click(function(){a("li:hidden",f).show();a("#PWGP_show").hide()})}});o();a("#PWGP_Load_Active").hide();function m(){a("#PWGP_Load_Active").show();g=a("#PWGP_catscroll").val();if(!g){g=0}a.ajax({url:PwgpAjax.ajaxUrl,data:{action:"pwgp-thumbnails",nonce:PwgpAjax.nonce,url:j,loaded:h,category:g,recursive:1},method:"post",success:function(q){o(q)}});var p=5;if(h>9){p=10}if(h>49){p=50}if(h>99){p=100}h+=p}function o(p){a(f).append(p);var r=(a("#PWGP_dragger img").first().height())+20;f.height(r);e.height(r+25).css("min-height",r+25);a("#PWGP_dropping ul").height(r);a("li",f).draggable({revert:true,cursor:"move",zIndex:50});var q=a("li",e).size()+a("li",f).size();a("#PWGP_show_stats").show().find("#PWGP_stats").text(" "+q+" / "+h);e.droppable({activeClass:"ui-state-highlight",drop:function(s,t){n(t.draggable)}});if(a("li:visible",f).size()>0){a("#PWGP_hide").show()}a("#PWGP_Load_Active").hide()}function n(p){p.fadeOut(function(){var q=a("ul",e);p.appendTo(q).fadeIn();a("a#PWGP_Gen").unbind().click(function(){var r=window.tinyMCE.majorVersion;a("img",e).each(function(){var t=a(this).attr("title").split("]");var s=t[0];var z=a("#thumbnail_size input[type=radio][name=thumbnail_size]:checked").attr("value");if(z!=="la"){s+=" size='"+z+"'"}var v=a("#display_name input[type=radio][name=display_name]:checked").attr("value");if(v!=="0"){s+=" name='"+v+"'"}a("input#desc_check[name=desc_check]").attr("value",0);$hdesc=0+a("input#desc_check[name=desc_check]:checked").attr("value",1).attr("value");if($hdesc==1){s+=" desc=1"}var x=a("#photo_class").val();if(x!=""){s+=" class='"+x+"'"}var w=a("#link_type input[type=radio][name=link_type]:checked").attr("value");if(w!="picture"){s+=" lnktype='"+w+"'"}var y=a("#open_type input[type=radio][name=open_type]:checked").attr("value");if(y!=""){s+=" opntype='"+y+"'"}var u=a("#order_type input[type=radio][name=order_type]:checked").attr("value");if(u!=""){s+=" order='"+u+"'"}var s="\t"+s+"] \n\r";a("#content").insertAtCaret(s);if(r>="4"){tinyMCE.execCommand("mceInsertContent",false,s)}else{tinyMCE.execInstanceCommand("content","mceInsertContent",false,s)}})});a("a#PWGP_rst").unbind().click(function(){a("li",e).appendTo(f);a("a#PWGP_Gen").hide();a("a#PWGP_rst").hide();a("#PWGP_show_stats").show().find("#PWGP_stats").text(" "+a("li",f).size()+" / "+h)})});a("a#PWGP_Gen").show();a("a#PWGP_rst").show()}})});b=false}else{a("div#PWGP_shortcoder").hide();b=true}})})}(jQuery));